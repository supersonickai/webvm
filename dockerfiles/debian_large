FROM --platform=i386 i386/debian:bookworm
ARG DEBIAN_FRONTEND=noninteractive

# 1. Core Installation (Cleaned and Verified)
RUN apt-get update && apt-get -y upgrade && \
    apt-get install -y --no-install-recommends \
    apt-utils ca-certificates curl git nano nodejs python3 \
    xserver-xorg-core i3-wm xinit xterm dbus-x11 procps && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# 2. Create the user first to ensure directories exist
RUN useradd -m -s /bin/bash user && \
    echo "user:password" | chpasswd && \
    echo 'root:password' | chpasswd

# 3. Create config files ONLY in existing directories
RUN mkdir -p /home/user/.config/i3 && \
    echo "exec dbus-launch --exit-with-session i3" > /home/user/.xinitrc && \
    echo 'if [ -z "$DISPLAY" ] && [ "$XDG_VTNR" -eq 1 ]; then exec startx; fi' >> /home/user/.bashrc && \
    chown -R user:user /home/user/

# 4. Final runtime settings
ENV DISPLAY=:0
WORKDIR /home/user
USER user
CMD [ "/bin/bash" ]
